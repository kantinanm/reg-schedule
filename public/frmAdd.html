<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>

    <!-- jQuery Datepicker -->
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/themes/smoothness/jquery-ui.css" rel="stylesheet"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.0.2/jquery.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>

    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link href="https://fonts.googleapis.com/css?family=Mali" rel="stylesheet">

    <!-- myscript -->
    <script src="/public/js/script.js"></script>

    <title>ระบบจองห้องเรียนออนไลน์</title>
    <style>
      body{
        font-family: 'Mali', cursive;
      }
    </style>
  </head>
  <body>
    <div class="container-fluid">
      <nav class="navbar navbar-light bg-light">
        <a class="navbar-brand" href="#">
          <i class="material-icons">computer</i>
          ระบบจองห้องเรียนออนไลน์
        </a>
      </nav>
      <form>
        <div class="row">
          <div class="col-sm">
            <div class="card">
              <div class="card-header">จองห้องเรียน</div>
              <div class="card-body">
                <div class="form-group row">
                  <label for="cboSection" class="col-sm-2 col-form-label">เลือกสาขาวิชา</label>
                  <div class="col-sm-5">
                    <select class="custom-select" id="cboSection">
                      <option selected>Choose...</option>
                      <option value="303">วิศวกรรมไฟฟ้า</option>
                      <option value="305">วิศวกรรมคอมพิวเตอร์</option>
                    </select>
                  </div>
                </div>
                <div class="form-group row">
                  <label for="cboSubject" class="col-sm-2 col-form-label">รายวิชา</label>
                  <div class="col-sm-5">
                    <select class="custom-select" id="cboSubject">
                      <option value="000000" selected>Choose...</option>
                    </select>
                  </div>
                </div>
                <div class="form-group row">
                  <label for="mydate" class="col-sm-2 col-form-label">วันที่</label>
                  <div class="col-sm-3">
                    <input class="form-control" id="mydate">
                  </div>
                </div>
                <div class="form-group row">
                  <label for="cboStartTime" class="col-sm-2 col-form-label">เวลาเริ่มต้น</label>
                  <div class="col-sm-1">
                    <select id="cboStartTime" class="form-control">
                      <option selected>Choose...</option>
                    </select>
                  </div>
                  <label for="cboEndTime" class="col-sm-1 col-form-label">เวลาสิ้นสุด</label>
                  <div class="col-sm-1">
                    <select id="cboEndTime" class="form-control">
                      <option selected>Choose...</option>
                    </select>
                  </div>
                </div>
                <div class="form-group row">
                  <label for="onRoom" class="col-sm-2 col-form-label">ห้อง</label>
                  <div class="col-sm-3">
                    <input class="form-control" id="onRoom" disabled>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </form>
    </div>
    <script>
      $(document).ready(function(){
        $("#mydate").datepicker({
          changeYear: true,
          changeMonth: true,
          dateFormat: "dd/m/yy",
          yearRange: "-100:+20",
        });

        for(var i=8;i<21;i++){ //loop เวลาใน cboStartTime
          if(i<10){
            $('#cboStartTime')
            .append($("<option></option>")
              .attr("value","0"+i+":00")
              .text("0"+i+":00"));
          }else{
            $('#cboStartTime')
            .append($("<option></option>")
              .attr("value",i+":00")
              .text(i+":00"));
          }
        }
      });

      $( "#cboSection" ).change(function() {
        $("#cboSubject option").remove();
        $("#cboSubject").append('<option selected>Choose...</option>');
        $.getJSON( "http://localhost:3000/subject/"+$("#cboSection").val(), function( data ) {
          var subName = getSubject(data);
          $.each(subName, function(key, value) {
            var chkName = value.subject.replace(/[^A-Za-z0-9_\.]+/g, " ");
            chkName = chkName.split(".");
            chkName = chkName[0].trim();
              $('#cboSubject')
              .append($("<option></option>")
                .attr("value",value.code)
                .text(value.code+" "+chkName));
          });
        });
      });

      $( "#cboStartTime" ).change(function() {
        /* --------------- เมื่อเลือกเวลาใน cboStartTime ให้ loop เวลาใน cboEndTime ------------------*/
        var startTime = $('#cboStartTime').val(); //เช็คเวลาใน cboStartTime
        startTime = startTime.split(':');
        var myTime = parseInt(startTime[0])+1;
        $("#cboEndTime option").remove();
        $("#cboEndTime").append('<option selected>Choose...</option>');
        for(var j=myTime;j<22;j++){
          if(j<10){
            $('#cboEndTime')
            .append($("<option></option>")
              .attr("value","0"+j+":00")
              .text("0"+j+":00"));
          }else{
            $('#cboEndTime')
            .append($("<option></option>")
              .attr("value",j+":00")
              .text(j+":00"));
          }
        }
      });
    </script>
  </body>
</html>
